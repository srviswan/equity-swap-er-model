{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://company.com/schemas/cashflow-data-contract/v1.0.0",
  "title": "Cashflow Data Product Contract",
  "description": "Comprehensive data contract for the Cashflow Management Service accommodating various contract types, payout structures, and calculation flexibilities",
  "version": "1.0.0",
  "type": "object",
  "properties": {
    "contract": {
      "type": "object",
      "description": "Financial contract details with flexible structure support",
      "required": ["contractId", "contractType", "tradeDate", "effectiveDate", "maturityDate", "currency", "status", "notionalAmount", "counterpartyId", "payouts"],
      "properties": {
        "contractId": {
          "type": "string",
          "description": "Unique identifier for the contract",
          "minLength": 1,
          "maxLength": 100,
          "pattern": "^[A-Z0-9_-]+$"
        },
        "contractType": {
          "type": "string",
          "description": "Type of financial contract",
          "enum": [
            "EQUITY_SWAP",
            "INTEREST_RATE_SWAP", 
            "TOTAL_RETURN_SWAP",
            "CURRENCY_SWAP",
            "CREDIT_DEFAULT_SWAP",
            "COMMODITY_SWAP"
          ]
        },
        "tradeDate": {
          "type": "string",
          "format": "date",
          "description": "Date when the contract was traded"
        },
        "effectiveDate": {
          "type": "string", 
          "format": "date",
          "description": "Effective start date of the contract"
        },
        "maturityDate": {
          "type": "string",
          "format": "date", 
          "description": "Maturity date of the contract"
        },
        "currency": {
          "type": "string",
          "description": "Base currency for the contract",
          "pattern": "^[A-Z]{3}$",
          "examples": ["USD", "EUR", "GBP", "JPY"]
        },
        "status": {
          "type": "string",
          "description": "Current status of the contract",
          "enum": ["ACTIVE", "INACTIVE", "EXPIRED", "TERMINATED", "PENDING"]
        },
        "notionalAmount": {
          "type": "object",
          "description": "Base notional amount for the contract",
          "required": ["value", "currency"],
          "properties": {
            "value": {
              "type": "number",
              "description": "Monetary value",
              "minimum": 0,
              "multipleOf": 0.000001
            },
            "currency": {
              "type": "string",
              "pattern": "^[A-Z]{3}$"
            },
            "unit": {
              "type": "string",
              "description": "Unit of measurement (e.g., SHARES, CONTRACTS)",
              "enum": ["SHARES", "CONTRACTS", "UNITS", "CURRENCY"]
            }
          }
        },
        "counterpartyId": {
          "type": "string",
          "description": "Identifier for the counterparty",
          "minLength": 1,
          "maxLength": 100
        },
        "payouts": {
          "type": "array",
          "description": "List of payout structures with polymorphic support",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["payoutId", "payoutType", "payerId", "receiverId"],
            "properties": {
              "payoutId": {
                "type": "string",
                "description": "Unique identifier for the payout",
                "minLength": 1,
                "maxLength": 100
              },
              "payoutType": {
                "type": "string",
                "description": "Type of payout",
                "enum": ["INTEREST_RATE", "PERFORMANCE", "DIVIDEND", "PRINCIPAL"]
              },
              "payerId": {
                "type": "string",
                "description": "Identifier of the payer",
                "minLength": 1,
                "maxLength": 100
              },
              "receiverId": {
                "type": "string", 
                "description": "Identifier of the receiver",
                "minLength": 1,
                "maxLength": 100
              }
            },
            "allOf": [
              {
                "if": {
                  "properties": {
                    "payoutType": { "const": "INTEREST_RATE" }
                  }
                },
                "then": {
                  "required": ["notionalAmount", "rateSpecification", "currency"],
                  "properties": {
                    "notionalAmount": {
                      "$ref": "#/properties/contract/properties/notionalAmount"
                    },
                    "rateSpecification": {
                      "type": "object",
                      "description": "Rate specification with polymorphic support",
                      "required": ["rateType"],
                      "properties": {
                        "rateType": {
                          "type": "string",
                          "enum": ["FIXED", "FLOATING"]
                        }
                      },
                      "allOf": [
                        {
                          "if": {
                            "properties": {
                              "rateType": { "const": "FIXED" }
                            }
                          },
                          "then": {
                            "required": ["rate"],
                            "properties": {
                              "rate": {
                                "type": "number",
                                "description": "Fixed interest rate",
                                "minimum": 0,
                                "maximum": 1
                              }
                            }
                          }
                        },
                        {
                          "if": {
                            "properties": {
                              "rateType": { "const": "FLOATING" }
                            }
                          },
                          "then": {
                            "required": ["floatingRateIndex", "spread"],
                            "properties": {
                              "floatingRateIndex": {
                                "type": "string",
                                "description": "Reference rate index",
                                "examples": ["LIBOR", "SOFR", "EURIBOR"]
                              },
                              "spread": {
                                "type": "number",
                                "description": "Spread over the floating rate"
                              },
                              "resetFrequency": {
                                "type": "string",
                                "description": "Frequency of rate resets",
                                "examples": ["DAILY", "MONTHLY", "QUARTERLY", "SEMI_ANNUAL", "ANNUAL"]
                              }
                            }
                          }
                        }
                      ]
                    },
                    "currency": {
                      "type": "string",
                      "pattern": "^[A-Z]{3}$"
                    },
                    "dayCountConvention": {
                      "type": "string",
                      "description": "Day count convention for interest calculation",
                      "examples": ["ACT/360", "ACT/365", "30/360", "ACT/ACT"]
                    },
                    "dayCountFraction": {
                      "type": "string",
                      "description": "Day count fraction method",
                      "examples": ["ACTUAL", "CALCULATED"]
                    },
                    "paymentFrequency": {
                      "type": "string",
                      "description": "Frequency of payments",
                      "examples": ["MONTHLY", "QUARTERLY", "SEMI_ANNUAL", "ANNUAL"]
                    },
                    "resetFrequency": {
                      "type": "string", 
                      "description": "Frequency of rate resets",
                      "examples": ["DAILY", "MONTHLY", "QUARTERLY", "SEMI_ANNUAL", "ANNUAL"]
                    },
                    "quantitySchedule": {
                      "type": "object",
                      "description": "Optional quantity schedule for varying notional amounts over time",
                      "properties": {
                        "unit": {
                          "type": "object",
                          "required": ["currency"],
                          "properties": {
                            "currency": {
                              "type": "string",
                              "pattern": "^[A-Z]{3}$"
                            },
                            "financialUnit": {
                              "type": "string",
                              "enum": ["SHARES", "CONTRACTS", "UNITS", "CURRENCY"]
                            }
                          }
                        },
                        "quantitySteps": {
                          "type": "array",
                          "description": "List of quantity steps over time",
                          "items": {
                            "type": "object",
                            "required": ["date", "quantity"],
                            "properties": {
                              "date": {
                                "type": "string",
                                "format": "date"
                              },
                              "quantity": {
                                "type": "number",
                                "minimum": 0,
                                "multipleOf": 0.000001
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              {
                "if": {
                  "properties": {
                    "payoutType": { "const": "PERFORMANCE" }
                  }
                },
                "then": {
                  "required": ["returnTerms"],
                  "properties": {
                    "returnTerms": {
                      "type": "object",
                      "description": "Performance return terms",
                      "properties": {
                        "priceReturnTerms": {
                          "type": "object",
                          "properties": {
                            "priceReturn": {
                              "type": "object",
                              "required": ["returnType"],
                              "properties": {
                                "returnType": {
                                  "type": "string",
                                  "enum": ["ABSOLUTE", "PERCENTAGE"]
                                },
                                "priceReturn": {
                                  "type": "number",
                                  "description": "Price return value"
                                }
                              }
                            }
                          }
                        },
                        "dividendReturnTerms": {
                          "type": "object",
                          "properties": {
                            "dividendReturn": {
                              "type": "number",
                              "description": "Dividend return value"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              },
              {
                "if": {
                  "properties": {
                    "payoutType": { "const": "DIVIDEND" }
                  }
                },
                "then": {
                  "required": ["dividendAmount", "currency"],
                  "properties": {
                    "dividendAmount": {
                      "$ref": "#/properties/contract/properties/notionalAmount"
                    },
                    "currency": {
                      "type": "string",
                      "pattern": "^[A-Z]{3}$"
                    },
                    "dividendDate": {
                      "type": "string",
                      "format": "date",
                      "description": "Date when dividend is paid"
                    }
                  }
                }
              }
            ]
          }
        }
      }
    },
    "calculationDate": {
      "type": "string",
      "format": "date",
      "description": "Date for which to calculate cashflow"
    },
    "calculationPeriod": {
      "type": "object",
      "description": "Optional calculation period specification",
      "properties": {
        "startDate": {
          "type": "string",
          "format": "date"
        },
        "endDate": {
          "type": "string", 
          "format": "date"
        },
        "periodType": {
          "type": "string",
          "enum": ["FULL_PERIOD", "PARTIAL_PERIOD", "ACCRUAL_PERIOD"]
        }
      }
    },
    "marketData": {
      "type": "object",
      "description": "Market data for calculations with flexible structure",
      "properties": {
        "rates": {
          "type": "object",
          "description": "Interest rates and indices",
          "additionalProperties": {
            "type": "number",
            "minimum": 0
          }
        },
        "prices": {
          "type": "object", 
          "description": "Asset prices and valuations",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "value": {
                "type": "number",
                "minimum": 0
              },
              "currency": {
                "type": "string",
                "pattern": "^[A-Z]{3}$"
              },
              "date": {
                "type": "string",
                "format": "date"
              }
            }
          }
        },
        "dividends": {
          "type": "array",
          "description": "Dividend information",
          "items": {
            "type": "object",
            "required": ["assetId", "amount", "currency", "exDate"],
            "properties": {
              "assetId": {
                "type": "string"
              },
              "amount": {
                "type": "number",
                "minimum": 0
              },
              "currency": {
                "type": "string",
                "pattern": "^[A-Z]{3}$"
              },
              "exDate": {
                "type": "string",
                "format": "date"
              },
              "payDate": {
                "type": "string",
                "format": "date"
              }
            }
          }
        },
        "volatilities": {
          "type": "object",
          "description": "Volatility data for derivatives",
          "additionalProperties": {
            "type": "number",
            "minimum": 0
          }
        }
      }
    },
        "options": {
          "type": "object",
          "description": "Calculation options and preferences",
          "properties": {
            "includeDividends": {
              "type": "boolean",
              "description": "Whether to include dividend calculations",
              "default": true
            },
            "dayCountConvention": {
              "type": "string",
              "description": "Day count convention for calculations",
              "enum": ["ACT/360", "ACT/365", "30/360", "ACT/ACT"],
              "default": "ACT/360"
            },
            "currency": {
              "type": "string",
              "description": "Base currency for calculations",
              "pattern": "^[A-Z]{3}$"
            },
            "precision": {
              "type": "integer",
              "description": "Decimal precision for calculations",
              "minimum": 2,
              "maximum": 16,
              "default": 8
            },
            "includeAccruals": {
              "type": "boolean",
              "description": "Whether to include accrued amounts",
              "default": true
            },
            "includePerformance": {
              "type": "boolean",
              "description": "Whether to include performance calculations",
              "default": true
            },
            "calculationMethod": {
              "type": "string",
              "description": "Calculation method to use",
              "enum": ["SIMPLE", "COMPLEX", "CDM_INSPIRED"],
              "default": "CDM_INSPIRED"
            },
            "timezone": {
              "type": "string",
              "description": "Timezone for date calculations",
              "default": "UTC"
            },
            "includeDetailedBreakdown": {
              "type": "boolean",
              "description": "Whether to include detailed daily/periodic breakdowns",
              "default": true
            },
            "breakdownGranularity": {
              "type": "string",
              "description": "Granularity level for detailed breakdowns",
              "enum": ["DAILY", "WEEKLY", "MONTHLY", "QUARTERLY", "PERIOD"],
              "default": "DAILY"
            },
            "includeAccrualSchedule": {
              "type": "boolean",
              "description": "Whether to include detailed accrual schedules",
              "default": true
            },
            "includeCashflowSchedule": {
              "type": "boolean",
              "description": "Whether to include detailed cashflow schedules",
              "default": true
            }
          }
        }
  },
  "required": ["contract", "calculationDate"],
  "additionalProperties": false,
  "definitions": {
    "CashflowSummary": {
      "type": "object",
      "description": "Consolidated cashflow summary with detailed breakdowns",
      "required": ["totalCashflow", "summaryByType", "summaryByPayout", "calculationPeriod"],
      "properties": {
        "totalCashflow": {
          "type": "object",
          "description": "Total cashflow amount across all payouts",
          "required": ["value", "currency"],
          "properties": {
            "value": {
              "type": "number",
              "description": "Total monetary value",
              "minimum": 0,
              "multipleOf": 0.000001
            },
            "currency": {
              "type": "string",
              "pattern": "^[A-Z]{3}$"
            },
            "unit": {
              "type": "string",
              "enum": ["SHARES", "CONTRACTS", "UNITS", "CURRENCY"]
            }
          }
        },
        "summaryByType": {
          "type": "object",
          "description": "Cashflow summary grouped by type",
          "properties": {
            "interestAmount": {
              "type": "object",
              "required": ["value", "currency"],
              "properties": {
                "value": {"type": "number", "minimum": 0},
                "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
              }
            },
            "dividendAmount": {
              "type": "object",
              "required": ["value", "currency"],
              "properties": {
                "value": {"type": "number", "minimum": 0},
                "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
              }
            },
            "performanceAmount": {
              "type": "object",
              "required": ["value", "currency"],
              "properties": {
                "value": {"type": "number"},
                "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
              }
            },
            "principalAmount": {
              "type": "object",
              "required": ["value", "currency"],
              "properties": {
                "value": {"type": "number", "minimum": 0},
                "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
              }
            }
          }
        },
        "summaryByPayout": {
          "type": "array",
          "description": "Cashflow summary for each payout",
          "items": {
            "type": "object",
            "required": ["payoutId", "payoutType", "totalAmount"],
            "properties": {
              "payoutId": {"type": "string"},
              "payoutType": {
                "type": "string",
                "enum": ["INTEREST_RATE", "PERFORMANCE", "DIVIDEND", "PRINCIPAL"]
              },
              "totalAmount": {
                "type": "object",
                "required": ["value", "currency"],
                "properties": {
                  "value": {"type": "number"},
                  "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
                }
              },
              "breakdown": {
                "type": "object",
                "properties": {
                  "accruedAmount": {
                    "type": "object",
                    "required": ["value", "currency"],
                    "properties": {
                      "value": {"type": "number"},
                      "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
                    }
                  },
                  "paidAmount": {
                    "type": "object",
                    "required": ["value", "currency"],
                    "properties": {
                      "value": {"type": "number"},
                      "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
                    }
                  },
                  "pendingAmount": {
                    "type": "object",
                    "required": ["value", "currency"],
                    "properties": {
                      "value": {"type": "number"},
                      "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
                    }
                  }
                }
              }
            }
          }
        },
        "calculationPeriod": {
          "type": "object",
          "description": "Period covered by the calculation",
          "required": ["startDate", "endDate", "totalDays"],
          "properties": {
            "startDate": {"type": "string", "format": "date"},
            "endDate": {"type": "string", "format": "date"},
            "totalDays": {"type": "integer", "minimum": 1},
            "businessDays": {"type": "integer", "minimum": 0},
            "accrualDays": {"type": "integer", "minimum": 0}
          }
        },
        "detailedBreakdown": {
          "type": "object",
          "description": "Detailed breakdown of cashflows",
          "properties": {
            "dailyBreakdown": {
              "type": "array",
              "description": "Daily cashflow breakdown",
              "items": {
                "$ref": "#/definitions/DailyCashflowEntry"
              }
            },
            "accrualSchedule": {
              "type": "array",
              "description": "Accrual schedule with periodic amounts",
              "items": {
                "$ref": "#/definitions/AccrualEntry"
              }
            },
            "cashflowSchedule": {
              "type": "array",
              "description": "Scheduled cashflow payments",
              "items": {
                "$ref": "#/definitions/CashflowScheduleEntry"
              }
            },
            "interestBreakdown": {
              "type": "array",
              "description": "Detailed interest calculations",
              "items": {
                "$ref": "#/definitions/InterestBreakdownEntry"
              }
            }
          }
        }
      }
    },
    "DailyCashflowEntry": {
      "type": "object",
      "description": "Daily cashflow entry",
      "required": ["date", "totalAmount"],
      "properties": {
        "date": {"type": "string", "format": "date"},
        "totalAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number"},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "interestAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number"},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "dividendAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number"},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "performanceAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number"},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "accruedAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number"},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "cumulativeAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number"},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        }
      }
    },
    "AccrualEntry": {
      "type": "object",
      "description": "Accrual schedule entry",
      "required": ["payoutId", "startDate", "endDate", "accruedAmount"],
      "properties": {
        "payoutId": {"type": "string"},
        "startDate": {"type": "string", "format": "date"},
        "endDate": {"type": "string", "format": "date"},
        "accruedAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number"},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "notionalAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number", "minimum": 0},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "rate": {"type": "number"},
        "dayCount": {"type": "integer", "minimum": 1},
        "dayCountFraction": {"type": "number", "minimum": 0, "maximum": 1}
      }
    },
    "CashflowScheduleEntry": {
      "type": "object",
      "description": "Scheduled cashflow payment entry",
      "required": ["payoutId", "paymentDate", "amount"],
      "properties": {
        "payoutId": {"type": "string"},
        "paymentDate": {"type": "string", "format": "date"},
        "amount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number"},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "status": {
          "type": "string",
          "enum": ["SCHEDULED", "PAID", "OVERDUE", "CANCELLED"]
        },
        "paymentType": {
          "type": "string",
          "enum": ["INTEREST", "DIVIDEND", "PRINCIPAL", "PERFORMANCE"]
        }
      }
    },
    "InterestBreakdownEntry": {
      "type": "object",
      "description": "Detailed interest calculation entry",
      "required": ["payoutId", "periodStart", "periodEnd", "interestAmount"],
      "properties": {
        "payoutId": {"type": "string"},
        "periodStart": {"type": "string", "format": "date"},
        "periodEnd": {"type": "string", "format": "date"},
        "interestAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number"},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "notionalAmount": {
          "type": "object",
          "required": ["value", "currency"],
          "properties": {
            "value": {"type": "number", "minimum": 0},
            "currency": {"type": "string", "pattern": "^[A-Z]{3}$"}
          }
        },
        "rate": {"type": "number"},
        "dayCount": {"type": "integer", "minimum": 1},
        "dayCountFraction": {"type": "number", "minimum": 0, "maximum": 1},
        "calculationMethod": {"type": "string"},
        "resetDate": {"type": "string", "format": "date"},
        "resetRate": {"type": "number"}
      }
    }
  },
  "examples": [
    {
      "contract": {
        "contractId": "SWAP_001",
        "contractType": "EQUITY_SWAP",
        "tradeDate": "2024-01-01",
        "effectiveDate": "2024-01-15",
        "maturityDate": "2025-01-15",
        "currency": "USD",
        "status": "ACTIVE",
        "notionalAmount": {
          "value": 1000000,
          "currency": "USD"
        },
        "counterpartyId": "CP_001",
        "payouts": [
          {
            "payoutId": "PAYOUT_001",
            "payoutType": "INTEREST_RATE",
            "payerId": "PARTY_A",
            "receiverId": "PARTY_B",
            "notionalAmount": {
              "value": 1000000,
              "currency": "USD"
            },
            "rateSpecification": {
              "rateType": "FLOATING",
              "floatingRateIndex": "SOFR",
              "spread": 0.005
            },
            "currency": "USD",
            "dayCountConvention": "ACT/360",
            "paymentFrequency": "QUARTERLY"
          }
        ]
      },
      "calculationDate": "2024-06-15",
      "options": {
        "includeDividends": true,
        "dayCountConvention": "ACT/360",
        "precision": 8
      }
    }
  ]
}
